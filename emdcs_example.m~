% chin jan 23 2013

% top script for calling emdcs

clear
close all
clc

addpath emd_flow/
addpath Utils/

%%%%% Construct synthetic signal

n = 100; w = 10;
k = 2; B = 20;

X = zeros(n,w);
X(1:(2*w),:) = [eye(w); eye(w)];

%figure, imagesc(X)
% Xn = X + 0.2*randn(size(X));
% [Xdenoise,~,~,~] = emd_flow(abs(Xn.^2),k,B,true);
% Xrec = double(Xdenoise).*Xn;
% figure, imagesc([Xn Xrec]), axis image


%%%%% acquire compressive measurements
N = n*w; K = k*w;
M = 200;

Phi = 1/sqrt(M)*randn(M,N); % can use random Fourier etc.
y = Phi*X(:);

%%%%% reconstruct using CoSaMP
iter = 50;
Xhat_cosamp = cosamp(y,Phi,K,iter);
Xhat_cosamp = reshape(Xhat_cosamp,n,w);
err_cosamp = norm(Xhat_cosamp - X, 'fro')/norm(X);


%%%%% reconstruct using EMDCS
opt.iter = 50; opt.tol = 1e-5; opt.K = K; opt.B = B;
opt.w = w; k = opt.k;
opt.verbose = true; opt.pause = 1;
Xhat_emdcs = emdcs(y,Phi,opt);
Xhat_emdcs = reshape(Xhat_emdcs,n,w);
err_emdcs = norm(Xhat_emdcs - X, 'fro')/norm(X);

